{
  "title": "Content Steering Dashboard",
  "uid": "content-steering-dashboard",
  "panels": [
    {
      "id": 1,
      "title": "Real-time Traffic by CDN",
      "type": "timeseries",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "timescaledb"
          },
          "rawSql": "SELECT\n    time_bucket('1 minute', time) AS \"time\",\n    current_cdn,\n    (sum(video_profile_kbps) / 1024) AS \"traffic_mbps\"\nFROM content_sessions\nWHERE\n    time BETWEEN $__timeFrom() AND $__timeTo()\nGROUP BY time_bucket('1 minute', time), current_cdn\nORDER BY \"time\";",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": { "x": 0, "y": 0, "h": 9, "w": 12 }
    },
    {
      "id": 2,
      "title": "CDN Usage vs. Max Capacity",
      "type": "table",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "timescaledb"
          },
          "rawSql": "SELECT\n    cs.current_cdn,\n    (sum(cs.video_profile_kbps) / 1024) AS \"current_usage_mbps\",\n    cc.max_capacity_mbps\nFROM content_sessions cs\nJOIN cdn_capacity cc ON cs.current_cdn = cc.cdn_name\nWHERE\n    cs.time BETWEEN $__timeFrom() AND $__timeTo()\nGROUP BY cs.current_cdn, cc.max_capacity_mbps;",
          "format": "table",
          "refId": "A"
        }
      ],
      "gridPos": { "x": 12, "y": 0, "h": 9, "w": 12 }
    }
  ],
  "time": { "from": "now-6h", "to": "now" },
  "refresh": "5s",
  "timezone": "utc",
  "editable": false,
  "schemaVersion": 41
}